<app-navbar></app-navbar>

<div class="container">
  <div class="page-header">
    <h1>Nouvelle analyse</h1>
    <p class="subtitle">Entre les données de ta course pour recevoir une analyse personnalisée</p>
  </div>

  <div class="main-layout">
    <!-- Zone principale : Formulaire -->
    <div class="main-content">
      <form class="run-form">
        <div class="form-grid">
          <!-- Date -->
          <div class="form-group">
            <label for="date">Date</label>
            <input type="date" id="date" [(ngModel)]="runData.date" name="date">
          </div>

          <!-- Distance -->
          <div class="form-group">
            <label for="distance">Distance (km)</label>
            <input type="number" id="distance" [(ngModel)]="runData.distance" name="distance" step="0.01" placeholder="10.5">
          </div>

          <!-- Durée -->
          <div class="form-group">
            <label for="duration">Durée (min)</label>
            <input type="number" id="duration" [(ngModel)]="runData.duration" name="duration" placeholder="55">
          </div>

          <!-- Allure -->
          <div class="form-group">
            <label for="pace">Allure moyenne (min/km)</label>
            <input type="text" id="pace" [(ngModel)]="runData.averagePace" name="averagePace" placeholder="5:15">
          </div>

          <!-- FC Moyenne -->
          <div class="form-group">
            <label for="avgHr">FC moyenne (bpm)</label>
            <input type="number" id="avgHr" [(ngModel)]="runData.averageHeartRate" name="averageHeartRate" placeholder="145">
          </div>

          <!-- FC Max -->
          <div class="form-group">
            <label for="maxHr">FC max (bpm)</label>
            <input type="number" id="maxHr" [(ngModel)]="runData.maxHeartRate" name="maxHeartRate" placeholder="165">
          </div>

          <!-- Cadence -->
          <div class="form-group">
            <label for="cadence">Cadence (ppm)</label>
            <input type="number" id="cadence" [(ngModel)]="runData.averageCadence" name="averageCadence" placeholder="180">
          </div>

          <!-- Dénivelé -->
          <div class="form-group">
            <label for="elevation">Dénivelé + (m)</label>
            <input type="number" id="elevation" [(ngModel)]="runData.elevationGain" name="elevationGain" placeholder="120">
          </div>

          <!-- Type de séance -->
          <div class="form-group">
            <label for="sessionType">Type de séance</label>
            <select id="sessionType" [(ngModel)]="runData.sessionType" name="sessionType">
              <option value="">-- Sélectionner --</option>
              @for (type of sessionTypes; track type) {
                <option [value]="type">{{ type }}</option>
              }
            </select>
          </div>

          <!-- Ressenti -->
          <div class="form-group">
            <label for="feeling">Ressenti (1-10)</label>
            <input type="number" id="feeling" [(ngModel)]="runData.feeling" name="feeling" min="1" max="10" placeholder="7">
          </div>
        </div>

        <!-- Notes -->
        <div class="form-group full-width">
          <label for="notes">Notes</label>
          <textarea id="notes" [(ngModel)]="runData.notes" name="notes" rows="3" placeholder="Sensation de facilité, météo, terrain..."></textarea>
        </div>
      </form>
    </div>

    <!-- Sidebar : Actions et résultats -->
    <div class="sidebar">
      <!-- Carte Actions -->
      <div class="sidebar-card actions-card">
        <h3>Actions</h3>
        <div class="sidebar-actions">
          <button type="button" class="btn-primary" (click)="submitRun()" [disabled]="isLoading()">
            @if (isLoading()) {
              Analyse en cours...
            } @else {
              Analyser ma course
            }
          </button>
          <button type="button" class="btn-secondary" (click)="resetForm()">Réinitialiser</button>
        </div>
      </div>

      <!-- Carte Résultat (conditionnelle) -->
      @if (isLoading() || error() || analysis()) {
        <div class="sidebar-card result-card">
          <h3>Analyse</h3>

          @if (isLoading()) {
            <div class="loading-state">
              <div class="loading-spinner"></div>
              <p>Analyse en cours...</p>
            </div>
          }

          @if (error()) {
            <div class="error-state">
              {{ error() }}
            </div>
          }

          @if (analysis()) {
            <div class="analysis-result">
              <p>{{ analysis() }}</p>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
